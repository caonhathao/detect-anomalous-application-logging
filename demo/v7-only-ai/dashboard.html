<!DOCTYPE html>
<html>
<head>
    <title>Real-Time Log Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body style="font-family: Arial; background: #111; color: #eee;">

<h1>âš¡ Real-Time Log Analysis Dashboard</h1>
<p>(Tá»± cáº­p nháº­t má»—i 20 request)</p>

<!-- METRIC SUMMARY -->
<div style="margin-bottom: 20px; padding: 10px; background: #222; border-radius: 8px; width: 900px;">
    <h2>ðŸ“Š Evaluation Metrics</h2>
    <table style="width: 1000px; color: #eee; font-size: 18px;">
        <tr>
            <td>Precision:</td><td id="precision">0</td>
            <td>Recall:</td><td id="recall">0</td>
            <td>F1-score:</td><td id="f1">0</td>
        </tr>
        <tr>
            <td>TP:</td><td id="tp">0</td>
            <td>FP:</td><td id="fp">0</td>
            <td>TN:</td><td id="tn">0</td>
            <td>FN:</td><td id="fn">0</td>
        </tr>
        <tr>
            <td>RPS:</td><td id="rps">0</td>
            <td>TPS:</td><td id="tps">0</td>
            <td>Avg Latency (ms):</td><td id="avg_latency">0</td>
        </tr>
    </table>
</div>

<div style="width: 950px; display: flex; flex-direction: row; justify-content: space-between; gap: 10px;">
    <canvas id="latencyChart" width="600" height="250"></canvas>
    <canvas id="ratioChart" width="600" height="250"></canvas>
</div>

<br>

<canvas id="throughputChart" width="1200" height="300"></canvas>

<script>
/* ------------------ CHART 1: LATENCY ------------------ */
let latencyChart = new Chart(document.getElementById("latencyChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [{
            label: "Avg Latency (ms)",
            data: [],
            borderColor: "cyan"
        }]
    }
});

/* ------------------ CHART 2: SAFE / MAL / UNKNOWN ------------------ */
let ratioChart = new Chart(document.getElementById("ratioChart"), {
    type: "bar",
    data: {
        labels: ["Safe", "Malicious", "Unknown"],
        datasets: [{
            label: "Count",
            data: [0, 0, 0],
            backgroundColor: ["green", "red", "yellow"]
        }]
    }
});

/* ------------------ CHART 3: THROUGHPUT (RPS/TPS) ------------------ */
let throughputChart = new Chart(document.getElementById("throughputChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            {
                label: "RPS (Requests/sec)",
                data: [],
                borderColor: "orange"
            },
            {
                label: "TPS (Tokens/sec)",
                data: [],
                borderColor: "lightgreen"
            }
        ]
    }
});


/* ------------------ WEBSOCKET UPDATE ------------------ */
let ws = new WebSocket("ws://localhost:8765");

ws.onmessage = (event) => {
    let data = JSON.parse(event.data);

    /* ---- Update Latency Chart ---- */
    latencyChart.data.labels.push(data.total);
    latencyChart.data.datasets[0].data.push(data.avg_latency * 1000);
    latencyChart.update();

    /* ---- Update Safe/Malicious/Unknown Chart ---- */
    ratioChart.data.datasets[0].data = [data.safe, data.malicious, data.unknown];
    ratioChart.update();

    /* ---- Update Throughput Chart ---- */
    throughputChart.data.labels.push(data.total);
    throughputChart.data.datasets[0].data.push(data.rps);
    throughputChart.data.datasets[1].data.push(data.tps);
    throughputChart.update();

    /* ---- Update SUMMARY TABLE ---- */
    document.getElementById("precision").innerText = data.precision.toFixed(4);
    document.getElementById("recall").innerText    = data.recall.toFixed(4);
    document.getElementById("f1").innerText       = data.f1.toFixed(4);

    document.getElementById("tp").innerText = data.TP;
    document.getElementById("fp").innerText = data.FP;
    document.getElementById("tn").innerText = data.TN;
    document.getElementById("fn").innerText = data.FN;

    document.getElementById("rps").innerText = data.rps.toFixed(2);
    document.getElementById("tps").innerText = data.tps.toFixed(2);

    document.getElementById("avg_latency").innerText = (data.avg_latency * 1000).toFixed(2);
};
</script>

</body>
</html>
